<Window x:Class="ScreenCapture.UI.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="clr-namespace:ScreenCapture.UI.ViewModels"
        mc:Ignorable="d"
        Title="Settings - ScreenCapture.NET"
        Height="520" Width="480"
        MinHeight="480" MinWidth="400"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <!-- Section Header Style -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,16,0,8" />
        </Style>

        <!-- Label Style -->
        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- Secondary Label Style -->
        <Style x:Key="SecondaryLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}" />
            <Setter Property="FontSize" Value="11" />
        </Style>

        <!-- CheckBox Style -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}" />
            <Setter Property="Margin" Value="0,4" />
        </Style>

        <!-- TextBox Style -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
            <Setter Property="Foreground" Value="{StaticResource TextBrush}" />
            <Setter Property="BorderBrush" Value="#3D3D3D" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="CaretBrush" Value="{StaticResource TextBrush}" />
        </Style>

        <!-- ComboBox Style -->
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
            <Setter Property="Foreground" Value="{StaticResource TextBrush}" />
            <Setter Property="BorderBrush" Value="#3D3D3D" />
            <Setter Property="Padding" Value="8,6" />
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Settings Content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel>

                <!-- General Section -->
                <TextBlock Text="General" Style="{StaticResource SectionHeaderStyle}" Margin="0,0,0,8" />
                <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="16">
                    <StackPanel>
                        <CheckBox x:Name="StartMinimizedCheckBox" 
                                  Content="Start minimized to system tray" 
                                  IsChecked="{Binding StartMinimized}" />
                        <CheckBox x:Name="AutoStartCheckBox" 
                                  Content="Start automatically with Windows" 
                                  IsChecked="{Binding AutoStartWithWindows}" />
                    </StackPanel>
                </Border>

                <!-- Capture Section -->
                <TextBlock Text="Capture Hotkey" Style="{StaticResource SectionHeaderStyle}" />
                <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Press a key combination to trigger screen capture:" 
                                   Style="{StaticResource LabelStyle}" Margin="0,0,0,12" />
                        
                        <!-- Modifier Checkboxes -->
                        <WrapPanel Margin="0,0,0,12">
                            <CheckBox Content="Ctrl" IsChecked="{Binding HotkeyCtrl}" Margin="0,0,16,0" />
                            <CheckBox Content="Alt" IsChecked="{Binding HotkeyAlt}" Margin="0,0,16,0" />
                            <CheckBox Content="Shift" IsChecked="{Binding HotkeyShift}" Margin="0,0,16,0" />
                            <CheckBox Content="Win" IsChecked="{Binding HotkeyWin}" />
                        </WrapPanel>

                        <!-- Hotkey Display & Record Button -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Background="#1A1A1A" BorderBrush="#3D3D3D" BorderThickness="1" 
                                    CornerRadius="4" Padding="12,8" Margin="0,0,8,0">
                                <TextBlock x:Name="HotkeyDisplay" 
                                           Text="{Binding HotkeyDisplayText}" 
                                           Foreground="{StaticResource TextBrush}"
                                           FontFamily="Consolas"
                                           FontSize="14" />
                            </Border>

                            <Button Grid.Column="1" 
                                    Content="{Binding IsRecordingHotkey, Converter={x:Null}, FallbackValue='Record Key'}"
                                    Command="{Binding StartRecordingHotkeyCommand}"
                                    Style="{StaticResource PrimaryButtonStyle}"
                                    Width="100" />
                        </Grid>

                        <TextBlock Text="Tip: Print Screen is recommended for quick access" 
                                   Style="{StaticResource SecondaryLabelStyle}" Margin="0,8,0,0" />
                    </StackPanel>
                </Border>

                <!-- Save Section -->
                <TextBlock Text="Save Settings" Style="{StaticResource SectionHeaderStyle}" />
                <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="16">
                    <StackPanel>
                        <!-- Default Folder -->
                        <TextBlock Text="Default save folder:" Style="{StaticResource LabelStyle}" Margin="0,0,0,8" />
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="SaveFolderTextBox" 
                                     Text="{Binding DefaultSaveFolder, UpdateSourceTrigger=PropertyChanged}" 
                                     IsReadOnly="True" />
                            <Button Grid.Column="1" 
                                    Content="Browse..." 
                                    Command="{Binding BrowseFolderCommand}"
                                    Style="{StaticResource PrimaryButtonStyle}"
                                    Margin="8,0,0,0" />
                        </Grid>

                        <!-- Default Format -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Default format:" Style="{StaticResource LabelStyle}" 
                                       Margin="0,0,16,0" />
                            <ComboBox Grid.Column="1" 
                                      x:Name="FormatComboBox"
                                      SelectedIndex="{Binding DefaultImageFormat, Converter={x:Null}}"
                                      MaxWidth="120" HorizontalAlignment="Left">
                                <ComboBoxItem Content="PNG" />
                                <ComboBoxItem Content="JPG" />
                            </ComboBox>
                        </Grid>

                        <!-- JPG Quality -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="JPG Quality:" Style="{StaticResource LabelStyle}" 
                                       Margin="0,0,16,0" />
                            <Slider Grid.Column="1" 
                                    x:Name="QualitySlider"
                                    Minimum="60" Maximum="100" 
                                    Value="{Binding JpgQuality}"
                                    TickFrequency="10" 
                                    IsSnapToTickEnabled="False"
                                    VerticalAlignment="Center" />
                            <TextBlock Grid.Column="2" 
                                       Text="{Binding JpgQuality, StringFormat={}{0}%}" 
                                       Style="{StaticResource LabelStyle}"
                                       Width="40" TextAlignment="Right" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Behavior Section -->
                <TextBlock Text="Behavior" Style="{StaticResource SectionHeaderStyle}" />
                <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="16">
                    <StackPanel>
                        <CheckBox Content="Copy to clipboard after capture" 
                                  IsChecked="{Binding CopyToClipboardAfterCapture}" />
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Button Bar -->
        <Border Grid.Row="1" 
                Background="{StaticResource SurfaceBrush}" 
                CornerRadius="8" 
                Margin="0,16,0,0" 
                Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Unsaved Changes Indicator -->
                <TextBlock Grid.Column="0"
                           Text="â— Unsaved changes"
                           Foreground="{StaticResource AccentBrush}"
                           FontSize="12"
                           VerticalAlignment="Center"
                           Visibility="{Binding HasChanges, Converter={x:Null}, FallbackValue=Collapsed}" />

                <!-- Buttons -->
                <Button Grid.Column="2" 
                        x:Name="ApplyButton"
                        Content="Apply" 
                        Command="{Binding ApplyCommand}"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Margin="0,0,8,0" />
                        
                <Button Grid.Column="3" 
                        x:Name="CancelButton"
                        Content="Cancel" 
                        Command="{Binding CancelCommand}"
                        Background="#3D3D3D"
                        Foreground="{StaticResource TextBrush}"
                        Padding="16,8"
                        BorderThickness="0"
                        Cursor="Hand"
                        Margin="0,0,8,0" />

                <Button Grid.Column="4" 
                        x:Name="SaveButton"
                        Content="Save" 
                        Command="{Binding SaveCommand}"
                        Style="{StaticResource PrimaryButtonStyle}" />
            </Grid>
        </Border>
    </Grid>
</Window>
